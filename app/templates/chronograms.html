{% extends "base.html" %}
{% set title = "Cronogramas" %}
{% block content %}
<form class="filters" method="get">
  <div>
    <label>ID PRE</label>
    <input name="id" value="{{ filters.id if filters.id is defined else '' }}" />
  </div>
  <div>
    <label>Ano</label>
    <input name="ano" value="{{ filters.ano }}" />
  </div>
  <div>
    <label>Mes</label>
    <select name="mes">
      <option value="">Todos</option>
      {% for month in months %}
        <option value="{{ month.value }}" {% if filters.mes == month.value %}selected{% endif %}>{{ month.label }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label>Turno</label>
    <select name="turno_id">
      <option value="">Todos</option>
      {% for shift in shifts %}
        <option value="{{ shift.id }}" {% if filters.turno_id == shift.id %}selected{% endif %}>{{ shift.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label>Instrutor</label>
    <select name="instrutor_id">
      <option value="">Todos</option>
      {% for collaborator in instructors %}
        <option value="{{ collaborator.id }}" {% if filters.instrutor_id == collaborator.id %}selected{% endif %}>{{ collaborator.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label>Analista</label>
    <select name="analista_id">
      <option value="">Todos</option>
      {% for collaborator in analysts %}
        <option value="{{ collaborator.id }}" {% if filters.analista_id == collaborator.id %}selected{% endif %}>{{ collaborator.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label>Assistente</label>
    <select name="assistente_id">
      <option value="">Todos</option>
      {% for collaborator in assistants %}
        <option value="{{ collaborator.id }}" {% if filters.assistente_id == collaborator.id %}selected{% endif %}>{{ collaborator.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="actions chrono-actions">
    <button class="button chrono-btn" type="submit">Filtrar</button>
    <a class="button ghost chrono-btn" href="/chronograms">Limpar</a>
  </div>
</form>

<div class="table-wrapper">
  <table class="table">
    <thead>
      <tr>
        <th>ID PRE</th>
        <th>Mes/Ano</th>
        <th>Curso</th>
        <th>Turma</th>
        <th>Turno</th>
        <th>Ambiente</th>
        <th>Instrutor</th>
        <th>Analista</th>
        <th>Assistente</th>
        <th>Status</th>
        <th>Atualizado em</th>
        <th>Acoes</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
        <tr>
          <td>{{ row.id }}</td>
          <td>{{ row.mes_label }} / {{ row.ano }}</td>
          <td>{{ row.curso }}</td>
          <td>{{ row.turma }}</td>
          <td>{{ row.turno }}</td>
          <td>{{ row.ambiente }}</td>
          <td>{{ row.instrutor }}</td>
          <td>{{ row.analista }}</td>
          <td>{{ row.assistente }}</td>
          <td>{{ row.status }}</td>
          <td>
            <div>{{ row.updated_at }}</div>
            <small>{{ row.updated_by }}</small>
          </td>
          <td>
            <div class="chrono-row-actions">
              <a class="button chrono-btn" href="/chronograms/{{ row.id }}/edit">Editar</a>
              <a class="button ghost chrono-btn" href="/programming/{{ row.id }}/pre-chronogram" target="_blank">Visualizar</a>
              <form method="post" action="/chronograms/{{ row.id }}/share">
                <button class="button secondary chrono-btn" type="submit">Atualizar Link</button>
              </form>
            </div>
          </td>
        </tr>
      {% endfor %}
      {% if not rows %}
        <tr>
          <td colspan="12">Nenhum cronograma encontrado para os filtros informados.</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

<style>
  .chrono-btn {
    min-width: 92px;
    min-height: 34px;
    padding: 6px 12px;
    font-size: 13px;
    border-radius: 8px;
    line-height: 1;
  }

  .filters .actions {
    align-items: end;
    gap: 8px;
  }

  .chrono-actions {
    flex-direction: column;
    align-items: stretch !important;
    justify-content: flex-end;
  }

  .chrono-row-actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .chrono-row-actions form {
    margin: 0;
  }
</style>
{% endblock %}

