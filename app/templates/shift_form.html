{% extends "base.html" %}
{% set title = "Turno" %}
{% block content %}
<form class="form" method="post">
  <div class="form-row">
    <div>
      <label>ID</label>
      <input name="shift_id" value="{{ shift.id if shift else shift_id }}" readonly required />
    </div>
    <div>
      <label>Nomenclatura</label>
      {% set nome = shift.nome if shift else '' %}
      <select name="nome" required>
        <option value="Manhã" {% if nome == "Manhã" %}selected{% endif %}>Manhã</option>
        <option value="Tarde" {% if nome == "Tarde" %}selected{% endif %}>Tarde</option>
        <option value="Noite" {% if nome == "Noite" %}selected{% endif %}>Noite</option>
        <option value="Especial" {% if nome == "Especial" %}selected{% endif %}>Especial</option>
      </select>
    </div>
  </div>
  <div class="form-row">
    <div>
      <label>Horário início</label>
      <input name="horario_inicio" id="horario-inicio" type="time" value="{{ shift.horario_inicio if shift else '' }}" required />
    </div>
    <div>
      <label>Horário fim</label>
      <input name="horario_fim" id="horario-fim" type="time" value="{{ shift.horario_fim if shift else '' }}" required />
    </div>
    <div>
      <label>Hs/Dia</label>
      <input name="hs_dia" id="hs-dia" value="{{ shift.hs_dia if shift else '' }}" readonly />
    </div>
    <div>
      <label>Status</label>
      <select name="ativo">
        <option value="true" {% if shift and shift.ativo %}selected{% endif %}>Ativo</option>
        <option value="false" {% if shift and not shift.ativo %}selected{% endif %}>Inativo</option>
      </select>
    </div>
  </div>
  <div class="actions">
    <button class="button" type="submit">Salvar</button>
    <a class="button ghost" href="/shifts">Cancelar</a>
  </div>
</form>

<script>
  const inicioInput = document.getElementById("horario-inicio");
  const fimInput = document.getElementById("horario-fim");
  const hsDiaInput = document.getElementById("hs-dia");

  function calcularHsDia() {
    if (!inicioInput.value || !fimInput.value) {
      hsDiaInput.value = "";
      return;
    }
    const [startH, startM] = inicioInput.value.split(":").map(Number);
    const [endH, endM] = fimInput.value.split(":").map(Number);
    const start = startH * 60 + startM;
    const end = endH * 60 + endM;
    if (end <= start) {
      hsDiaInput.value = "";
      return;
    }
    const diff = end - start;
    const hours = String(Math.floor(diff / 60)).padStart(2, "0");
    const minutes = String(diff % 60).padStart(2, "0");
    hsDiaInput.value = `${hours}:${minutes}`;
  }

  inicioInput.addEventListener("input", calcularHsDia);
  fimInput.addEventListener("input", calcularHsDia);
  calcularHsDia();
</script>
{% endblock %}
